# Инструкция по загрузке сайта (PythonAnywhere)

Так как ваш сайт использует базу данных SQLite (файл `database.db`), лучший бесплатный хостинг для вас — **PythonAnywhere**. Другие сервисы (как Render или Heroku) будут удалять вашу базу данных при каждой перезагрузке.

Вот пошаговая инструкция:

## Шаг 1: Регистрация
1. Зайдите на [www.pythonanywhere.com](https://www.pythonanywhere.com/)
2. Нажмите **Pricing & Signup** -> **Create a Beginner account** (Бесплатно).
3. Зарегистрируйтесь.

## Шаг 2: Загрузка файлов (ВАЖНО!)
1. На панели управления (Dashboard) перейдите во вкладку **Files**.
2. Вы увидите директорию `/home/ваш_никнейм/`.
3. Нажмите кнопку **Upload a file** и загрузите следующие файлы из вашего проекта:
   - `requirements.txt`
   - `database.db`
   - `db.py`
   - `main.py` (если нужен бот)
   - `.env` (если есть)

4. Создайте папку `web` (введите `web` в поле справа от "Directories" и нажмите "New directory").
5. Перейдите в папку `web` и загрузите туда:
   - `app.py`

6. **Внутри папки `web`** создайте папку `templates`.
7. Перейдите в `web/templates` и загрузите туда все ваши `.html` файлы:
   - `base.html`
   - `index.html`
   - `login.html`
   - `matches.html`
   - `leaderboard.html`
   - `clans.html`
   - `create_clan.html`
   - `clan_detail.html`
   - `clan_matchmaking.html`
   - `settings.html`
   - `play.html`
   
8. **Внутри папки `web/templates`** создайте папку `admin` и загрузите туда файлы из `web/templates/admin`:
   - `dashboard.html`
   - `users.html`
   - `clans.html`

**Итоговая структура файлов должна выглядеть так:**
```
/home/scybon/
  ├── database.db
  ├── db.py
  ├── main.py
  └── web/
      ├── app.py
      └── templates/
          ├── base.html
          ├── index.html
          ├── ... (остальные html)
          └── admin/
              ├── dashboard.html
              └── ...
```
Если структура другая — сайт не найдет файлы и выдаст ошибку `TemplateNotFound`.

## Шаг 3: Установка библиотек
1. Перейдите во вкладку **Consoles**.
2. Нажмите **Bash** (под "Start a new console").
3. В открывшемся черном окне введите команду:
   ```bash
   pip3 install -r requirements.txt
   ```
   Дождитесь окончания установки.

## Шаг 4: Настройка веб-приложения
1. Перейдите во вкладку **Web**.
2. Нажмите **Add a new web app**.
3. Нажмите **Next** -> выберите **Flask** -> выберите **Python 3.10** (или новее).
4. В поле "Path" (путь к файлу) укажите:
   `/home/ваш_никнейм/web/app.py`
   (Замените `ваш_никнейм` на ваш логин).
5. Нажмите **Next** -> **Finish**.

## Шаг 5: Настройка WSGI файла (ВАЖНО!)
1. На вкладке **Web**, найдите раздел "Code" и ссылку на **WSGI configuration file** (например, `/var/www/ваш_никнейм_pythonanywhere_com_wsgi.py`). Нажмите на нее.
2. Откройте файл и удалите **всё содержимое**.
3. Вставьте **ТОЛЬКО ЭТОТ КОД** (без кавычек и слова python):

```python
import sys
import os

# Путь к папке вашего проекта (где лежит app.py)
path = '/home/scybon/web'  
if path not in sys.path:
    sys.path.append(path)

# Путь к папке выше (где database.db), чтобы импорты работали
parent_path = '/home/scybon'
if parent_path not in sys.path:
    sys.path.append(parent_path)

# Импортируем приложение
from app import app as application
```

4. **ВНИМАНИЕ:** Я уже подставил ваш никнейм (`scybon`) в код выше, так как увидел его в логах. Просто скопируйте код и вставьте.
5. Нажмите **Save** (вверху справа).

## Шаг 6: Запуск
1. Вернитесь во вкладку **Web**.
2. Нажмите большую зеленую кнопку **Reload ...**.
3. Сверху будет ссылка вида `ваш_никнейм.pythonanywhere.com`.
4. Откройте её — ваш сайт работает! Эту ссылку можно кидать другу.

---
## Решение проблем с подключением ("Не удается получить доступ к сайту")

Если у друзей пишет "Превышено время ожидания ответа" (ERR_CONNECTION_TIMED_OUT) или "Не удается установить соединение":

1.  **Проверьте ссылку:**
    *   Друзьям нужно кидать ссылку **без https**, вот так:
        `http://scybon.pythonanywhere.com`
    *   Иногда провайдеры блокируют `https` для бесплатных доменов PythonAnywhere. Попробуйте именно `http://`.

2.  **Проверьте VPN:**
    *   Попросите друга **выключить VPN**, если он включен.
    *   ИЛИ наоборот, **включить VPN**, если сайт заблокирован в его стране (например, в РФ некоторые поддомены могут блокироваться).

3.  **Мобильный интернет:**
    *   Пусть друг попробует зайти с телефона через мобильный интернет (не через Wi-Fi). Если зайдет — проблема в его домашнем провайдере.

---

## Как обновлять сайт, чтобы НИЧЕГО НЕ ПРОПАДАЛО

**Главное правило:** Никогда не загружайте файл `database.db` на сервер, если вы не хотите всё стереть!

Когда я присылаю вам обновления (новые функции, исправления):

1.  **Загружайте ТОЛЬКО файлы с кодом:**
    *   `web/app.py`
    *   HTML файлы в `web/templates/`
    *   `db.py` (если меняли структуру базы)
    
2.  **НИКОГДА не трогайте файл `database.db` на сервере.**
    *   Этот файл хранит всех ваших игроков, кланы и матчи.
    *   Если вы замените его файлом с вашего компьютера — вы сотрете все данные на сервере своими локальными (пустыми) данными.

3.  **Просто нажмите Reload:**
    *   После загрузки кода (`app.py` или шаблонов) просто нажмите зеленую кнопку **Reload** на вкладке Web.
    *   База данных останется старой, а код обновится. Все игроки сохранятся.

**Если вы случайно удалили базу:**
К сожалению, на бесплатном тарифе восстановить её нельзя, если у вас нет резервной копии.
Чтобы сделать резервную копию:
1. Зайдите в Files.
2. Найдите `database.db`.
3. Скачайте его себе на компьютер (кнопка Download справа от файла). Делайте это раз в день.
4.  Пролистайте в самый низ. Там будет написано, почему сайт упал (например, `ImportError` или `SyntaxError`).
5.  Если видите ошибку базы данных, перейдите по ссылке `/debug/update_db` (см. выше), чтобы обновить структуру базы.

**Частые ошибки:**
*   **ModuleNotFoundError: No module named 'flask'**: Вы забыли выполнить Шаг 3 (установка библиотек).
*   **sqlite3.OperationalError: no such table**: База данных не найдена. Проверьте, что файл `database.db` лежит в папке `/home/ваш_никнейм/`, а не внутри `web`.
*   **ImportError: cannot import name 'app'**: Ошибка в WSGI файле. Проверьте путь (`/home/ваш_никнейм/web`) и имя файла (`app.py`).

**Как исправить быстро:**
Если ничего не помогает, попробуйте упростить структуру:
1. Переместите ВСЕ файлы (включая `app.py` и папку `templates`) в одну папку `/home/ваш_никнейм/mysite/`.
2. В WSGI файле укажите путь `/home/ваш_никнейм/mysite`.
